{{- /* check if current page is a column page */ -}}
{{- if or (hasPrefix .Page.RelPermalink "/tags/") (hasPrefix .Page.RelPermalink "/categories/") (hasPrefix .Page.RelPermalink "/about/") (hasPrefix .Page.RelPermalink "/posts/") -}}
  {{- .Page.Store.Set "ColumnMode" false -}}
{{- else -}}
  {{- .Page.Store.Set "ColumnMode" true -}}
{{- end -}}

<!DOCTYPE html>
<html lang="{{- site.Language.LanguageCode -}}" dir="{{- or site.Language.LanguageDirection `ltr` -}}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>{{- if .IsHome -}}{{- site.Title -}}{{- else -}}{{- printf "%s" .Title -}}{{- end -}}</title>

    {{- /* SEO zone */ -}}
    {{- if .IsHome -}}
      <meta name="keywords" content="{{- delimit site.Params.Keywords ", " -}}">
      <meta name="description" content="{{- site.Params.description -}}">
    {{- else if .IsPage -}}
      {{- if .Page.Params.DisableCrawl -}}
        <meta name="robots" content="noindex">
      {{- else -}}
        <meta name="keywords" content="{{- delimit .Keywords ", " -}}">
        <meta name="description" content="{{- .Description -}}">
      {{- end -}}
    {{- end -}}

    {{- partialCached "head/css.html" . -}}
    {{- partialCached "head/js.html" . -}}
    {{- if hugo.IsProduction -}}
      {{- if site.Config.Services.GoogleAnalytics.ID -}}
        {{- partial "google-analytics.html" -}}
      {{- end -}}
      {{- if site.Params.GoogleAdSense.ID -}}
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={{- site.Params.GoogleAdSense.ID -}}" crossorigin="anonymous"></script>
      {{- end -}}
    {{- end -}}
    {{- if .Param "math" -}}
      {{- partialCached "math.html" . -}}
    {{- end -}}
  </head>
  {{- /* FIXME: drawer-open will be rewritten by js, */ -}}
  <body class="min-h-screen grid grid-cols-1 md:grid-cols-[1fr_3fr] md:drawer-open">
    <input id="drawer" type="checkbox" class="drawer-toggle">

    {{- /* navbar, at left side, it's a drawer on mobile */ -}}
    <nav class="drawer-side pt-4 w-full md:w-1/4 md:min-h-screen md:max-h-screen overflow-y-auto z-50 bg-base-200">
      <label for="drawer" aria-label="close sidebar" class="drawer-overlay"></label>

      {{- /* logo zone */ -}}
      <div class="bg-base-100 w-full h-16 flex items-center justify-start">
        <a class="btn btn-ghost text-xl" href="/">{{- site.Title -}}</a>
      </div>

      {{- /* TODO: 或许有更好的解法 */ -}}
      {{- if .Page.Store.Get "ColumnMode"  -}}
        {{- partial "sidebar/column-toc.html" . -}}
      {{- else -}}
        {{- partialCached "sidebar/site-link.html" . -}}
      {{- end -}}
    </nav>

    <main class="drawer-content">
      {{- /* header bar */ -}}
      {{- partial "navbar.html" . -}}
      {{- /* article */ -}}
      {{- block "main" . -}}{{- end -}}
    </main>

    {{- /* check if content has code blocks */ -}}
    {{- if .Page.Store.Get "PageHasCode" -}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      new ClipboardJS('.btn-copy-code');
    });
    </script>
    {{- end -}}
  </body>
</html>
