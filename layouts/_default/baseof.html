<!DOCTYPE html>
<html
  lang="{{ site.Language.LanguageCode }}"
  dir="{{ or site.Language.LanguageDirection `ltr` }}"
>
  <head>
    {{ partial "head.html" . }}
  </head>
  <body class="flex flex-col items-center min-h-screen">
    <header class="navbar fixed top-0 w-full z-50 bg-neutral-content flex-none items-center">
      {{ partial "header.html" . }}
    </header>
    <div class="flex-grow mt-8 pt-16 flex flex-row">
      <main class="prose w-3/4 pr-4">
        {{ block "main" . }}{{ end }}
      </main>
      <aside class="sidebar right-0 top-16 h-full w-1/3 p-4">
        {{ $currentPage := . }}
        {{ $currentTags := .Params.tags }}
        {{ $relatedPosts := slice }}
        {{ range .Site.Pages }}
          {{ if and (ne .Permalink $currentPage.Permalink) (intersect .Params.tags $currentTags) }}
            {{ $relatedPosts = $relatedPosts | append . }}
          {{ end }}
        {{ end }}
        {{ $sortedPosts := sort $relatedPosts "Date" "desc" }}
        {{ $top10Posts := first 10 $sortedPosts }}

        {{ if gt (len $top10Posts) 0 }}
          <table class="table w-full">
            <thead>
              <tr>
                <th>相关帖子</th>
              </tr>
            </thead>
            <tbody>
              {{ range $top10Posts }}
              <tr
                class="hover:bg-base-200 cursor-pointer"
                data-href="{{ .RelPermalink }}"
                onclick="window.location.href=this.dataset.href"
              >
                <td>
                  <span class="text-primary">{{ .Title }}</span>
                </td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        {{ end }}

        <div class="latest-posts">
          <h2>最新帖子</h2>
          <ul>
              {{ range first 5 (where .Site.RegularPages "Type" "post").ByDate.Reverse }}
              <li>
                  <a href="{{ .Permalink }}">{{ .Title }}</a>
              </li>
              {{ end }}
          </ul>
        </div>

        <div id="post-categories">
          <h3>文章分类</h3>
          <table class="table">
            <thead>
              <tr>
                <th>分类</th>
                <th>数量</th>
              </tr>
            </thead>
            <tbody>
              {{ range .Site.Taxonomies.categories }}
              <tr>
                <td><a class="link link-hover" href="{{ .Page.Permalink }}">{{ .Page.Title }}</a></td>
                <td>{{ len .Pages }}</td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>

        <div class="w-full">
          <h3>标签</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- 第一栏 -->
            <ul class="space-y-2">
              {{ range $index, $element := first 10 (sort .Site.Taxonomies.tags.ByCount.Reverse "Count" "desc") }}
                <li class="bg-gray-100 rounded-lg p-2 flex justify-between items-center">
                  <span>{{ $element.Name }}</span>
                  <span class="text-gray-500">{{ $element.Count }}</span>
                </li>
              {{ end }}
            </ul>

            <!-- 第二栏 -->
            <ul class="space-y-2">
              {{ range $index, $element := first 10 (after 10 (sort .Site.Taxonomies.tags.ByCount.Reverse "Count" "desc")) }}
                <li class="bg-gray-100 rounded-lg p-2 flex justify-between items-center">
                  <span>{{ $element.Name }}</span>
                  <span class="text-gray-500">{{ $element.Count }}</span>
                </li>
              {{ end }}
            </ul>
          </div>
        </div>
      </aside>
    </div>
    <footer class="flex-none mt-8">{{ partial "footer.html" . }}</footer>
  </body>
</html>
