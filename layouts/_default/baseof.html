<!DOCTYPE html>
<html
  lang="{{ site.Language.LanguageCode }}"
  dir="{{ or site.Language.LanguageDirection `ltr` }}"
>
  <head>
    {{ partial "head.html" . }}
  </head>
  <body class="flex flex-col items-center min-h-screen">
    <header class="navbar fixed top-0 w-full z-50 bg-neutral-content flex-none items-center">
      {{ partial "header.html" . }}
    </header>
    <div class="flex-grow mt-8 pt-16 flex flex-row">
      <main class="prose w-3/4 pr-4">
        {{ block "main" . }}{{ end }}
      </main>
      <aside class="sidebar right-0 top-16 h-full w-1/3 p-4">
        {{ $currentPage := . }}
        {{ $currentTags := .Params.tags }}
        {{ $relatedPosts := slice }}
        {{ range .Site.RegularPages }}
          {{ if and (ne .Permalink $currentPage.Permalink) (intersect .Params.tags $currentTags) }}
            {{ $relatedPosts = $relatedPosts | append . }}
          {{ end }}
        {{ end }}
        {{ $sortedPosts := sort $relatedPosts "Date" "desc" }}
        {{ $top10Posts := first 10 $sortedPosts }}

        {{ if gt (len $top10Posts) 0 }}
          <table class="table w-full">
            <thead>
              <tr>
                <th>相关帖子</th>
              </tr>
            </thead>
            <tbody>
              {{ range $top10Posts }}
              <tr
                class="hover:bg-base-200 cursor-pointer"
                data-href="{{ .RelPermalink }}"
                onclick="window.location.href=this.dataset.href"
              >
                <td>
                  <span class="text-primary">{{ .Title }}</span>
                </td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        {{ end }}

        <div id="latest-posts">
          <table class="table w-full">
            <thead>
              <tr>
                <th>最新帖子</th>
              </tr>
            </thead>
            <tbody>
              {{ range first 5 .Site.RegularPages.ByDate.Reverse }}
              <tr
                class="hover:bg-base-200 cursor-pointer"
                data-href="{{ .Permalink }}"
                onclick="window.location.href=this.dataset.href"
              >
                <td>
                  <span class="text-primary">{{ .Title }}</span>
                </td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>

        <div id="post-categories">
          <table class="table w-full">
            <thead>
              <tr>
                <th>文章分类</th>
                <th>数量</th>
              </tr>
            </thead>
            <tbody>
              {{ range .Site.Taxonomies.categories.ByCount }}
              <tr
                class="hover:bg-base-200 cursor-pointer"
                data-href="{{ .Page.Permalink }}"
                onclick="window.location.href=this.dataset.href"
              >
                <td><span class="text-primary">{{ .Page.Title }}</span></td>
                <td>{{ len .Pages }}</td>
              </tr>
              {{ end }}
            </tbody>
          </table>
        </div>

        <table class="table">
          <thead>
            <tr>
              <th>标签</th>
            </tr>
          </thead>
          <tbody>
            {{ $tagList := first 20 .Site.Taxonomies.tags.ByCount }}
            {{ range $index, $tag := $tagList }}
              {{ if mod $index 2 | eq 0 }}
                <tr>
                  <td class="hover:bg-base-200">
                    <a href="{{ $tag.Page.Permalink }}" class="flex justify-between w-full text-primary">
                      <span>{{ $tag.Name }}</span>
                      <span class="text-gray-500">{{ $tag.Count }}</span>
                    </a>
                  </td>
                  {{ $next := index $tagList (add $index 1) }}
                  <td class="hover:bg-base-200">
                    <a href="{{ $next.Page.Permalink }}" class="flex justify-between w-full text-primary">
                      <span>{{ $next.Name }}</span>
                      <span class="text-gray-500">{{ $next.Count }}</span>
                    </a>
                  </td>
                </tr>
              {{ end }}
            {{ end }}
          </tbody>
        </table>
      </aside>
    </div>
    <footer class="flex-none mt-8">{{ partial "footer.html" . }}</footer>
  </body>
</html>
